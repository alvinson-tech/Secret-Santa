<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Secret Santa Matcher ‚ú®</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="organizerView" class="container">
        <h1>üéÖ Secret Santa Matcher ‚ú®</h1>
        
        <div class="sections-container">
            <div class="preset-section">
                <div class="preset-section">
                    <h2 class="section-heading">Presets</h2>
                    <button onclick="loadClassList()" style="background-color: var(--holiday-green);">Class 4A</button>
                </div>
            </div>
            <div class="manual-section">
                <div class="manual-section">
                    <h2 class="section-heading">Manual Entry</h2>
                    <div class="input-group">
                        <label>Number of Participants:</label>
                        <input type="number" id="participantCount" min="2" max="100" placeholder="Enter number (2-100)">
                        <button onclick="generateInputs()">Create Form</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="classList" class="class-list" style="display: none;"></div>
        <div id="participantInputs" class="participant-grid"></div>
        <button onclick="generateLinks()" id="generateButton" style="display:none">Generate Matches</button>
        <div id="links"></div>
    </div>

    <div id="revealerView" class="container" style="display:none">
        <h1>Your Secret Santa Match ü´Ç</h1>
        <div class="gift-container">
            <div class="gift-label">Click the gift to reveal!</div>
            <div class="gift-box" onclick="revealMatch()">üéÅ</div>
            <div class="name-reveal" id="nameReveal"></div>
        </div>
    </div>

    <!-- New footer -->
    <div class="footer">
        Coded with ‚ù§Ô∏è by Alvin
    </div>

    <script>
        let participants = [];
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('c');

        const classStudents = [
            "Mrs. Nikitha", "Lavanya", "Binusha", "Aakanksha", "Abdul Touheed", "Abhishek A", "Abhishek K", "Abhishek S S", 
            "Aditya Suresh", "Akash Surendra", "Akshata Suresh", "Akshay H", "Alvin", "Amulya", "Anaghashree", 
            "Ananya", "Aniketha", "Ankita", "Anushree", "Aralur Darshankumar", "Arfa Kulsum", "Arjun Sharma", 
            "Arun Eshwaroop", "Aviraj", "Ayush", "Balaji R", "Bapugouda", "Basavaraj", "Basavaraj B", "Bharath C", 
            "Bhargavi", "Bhavana", "Chandana Shree", "Chandan D P", "Channabasava", "Chethankumar", "Chethanashree", 
            "Chiranth L", "Christy Shephard", "D Manohar", "D Neha", "Danish", "Darshan", "Debaditya Das", "Deekshita", 
            "Deepthi", "Deeraj Ashok", "Dhanush D", "Dhanush Jain", "Dharshan V", "Dinesh Mange", "Disha", "E Vandana", 
            "Vishwanath", "Abdulaziz", "Abhishek Police Patil", "Abhishek Gouda", "Akbar", "Arpita Suresh", "Aryha K S", 
            "Ashish Gupta", "Ayesha", "Bhati Mohammed", "Bhavana A V", "Chandankumar V", "Vishesh Dhyan", "Darshan B", 
            "Darshan C", "Darshan Chikanna", "V Prajwal", "Mythri"
        ];

        if (code) {
            document.getElementById('revealerView').style.display = 'block';
            document.getElementById('organizerView').style.display = 'none';
        }

        function loadClassList() {
            const classList = document.getElementById('classList');
            classList.style.display = 'block';
            classList.innerHTML = '<h3 style="margin-bottom: 12px; color: var(--holiday-green);">Select Participants:</h3>';
            
            classStudents.forEach(student => {
                const div = document.createElement('div');
                div.className = 'student-item';
                div.innerHTML = `
                    <input type="checkbox" id="student-${student}" name="student-${student}" value="${student}">
                    <label for="student-${student}">${student}</label>
                `;
                classList.appendChild(div);
            });

            const selectButton = document.createElement('button');
            selectButton.textContent = 'Add Selected Students';
            selectButton.onclick = addSelectedStudents;
            classList.appendChild(selectButton);
        }

        function addSelectedStudents() {
            const selectedStudents = Array.from(document.querySelectorAll('.student-item input[type="checkbox"]:checked'))
                .map(checkbox => checkbox.value);
            
            if (selectedStudents.length < 2) {
                alert('Please select at least 2 students');
                return;
            }

            document.getElementById('participantCount').value = selectedStudents.length;
            generateInputs();

            const inputs = document.querySelectorAll('[name^="name"]');
            inputs.forEach((input, index) => {
                if (selectedStudents[index]) {
                    input.value = selectedStudents[index];
                }
            });

            document.getElementById('generateButton').style.display = 'block';
        }

        function generateInputs() {
            const count = parseInt(document.getElementById('participantCount').value);
            if (count < 2 || count > 100) {
                alert('Please enter a number between 2 and 100');
                return;
            }
            
            const container = document.getElementById('participantInputs');
            container.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const div = document.createElement('div');
                div.className = 'input-group';
                div.innerHTML = `<input required placeholder="Participant ${i + 1}" name="name${i}">`;
                container.appendChild(div);
            }
            document.getElementById('generateButton').style.display = 'block';
        }

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                console.error('Failed to copy text: ', err);
                return false;
            }
        }

        function generateLinks() {
            participants = [];
            const inputs = document.querySelectorAll('[name^="name"]');
            inputs.forEach(input => {
                if (input.value.trim()) {
                    participants.push(input.value.trim());
                }
            });

            if (participants.length < 2) {
                alert('Please add at least 2 participants');
                return;
            }

            let assigned = [...participants];
            do {
                assigned = assigned.sort(() => Math.random() - 0.5);
            } while (participants.some((p, i) => p === assigned[i]));

            const links = document.getElementById('links');
            links.innerHTML = '<h3 style="margin-bottom: 20px; color: var(--holiday-green);">Here is the Secret Santa List:</h3>';
            const linksGrid = document.createElement('div');
            linksGrid.className = 'links-grid';
            links.appendChild(linksGrid);

            participants.forEach((name, i) => {
                const assignment = assigned[i];
                const data = `${name}|${assignment}`;
                const encrypted = btoa(data).replace(/=/g, '').replace(/\+/g, '-').replace(/\//g, '_');
                const link = `${window.location.origin}${window.location.pathname}?c=${encrypted}`;
                
                const linkId = `link-${i}`;
                const div = document.createElement('div');
                div.className = 'link-item';
                div.innerHTML = `
                    <div class="link-text">
                        <strong>${name}'s Link</strong><br>
                        <span id="${linkId}" style="display: none">${link}</span>
                        <a href="${link}" target="_blank">Link #${String(i + 1).padStart(3, '0')}</a>
                    </div>
                    <button class="copy-btn" onclick="copyLink('${linkId}')" title="Copy Link">
                        <i class="fas fa-copy"></i>
                    </button>
                `;
                linksGrid.appendChild(div);
            });
        }

        // And update the reveal function to work with the new format:
        function revealMatch() {
            try {
                const decoded = atob(code.replace(/-/g, '+').replace(/_/g, '/'));
                const [name, match] = decoded.split('|');
                
                const giftBox = document.querySelector('.gift-box');
                giftBox.style.transform = 'scale(0)';
                giftBox.style.transition = 'all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                
                setTimeout(() => {
                    const nameReveal = document.getElementById('nameReveal');
                    nameReveal.innerHTML = `
                        <p>‚ú® Ho Ho Ho! ‚ú®</p>
                        <p>${name}, you are Secret Santa for:</p>
                        <h2>${match}</h2>
                        <p>üéÑ Merry Christmas! üéÑ</p>
                        <p>Be a Good Santa üéÖ</p>
                        <p>Deliver your üéÅ gifts on time! </p>
                    `;
                    nameReveal.style.opacity = '0';
                    nameReveal.style.transform = 'translateY(20px)';
                    nameReveal.style.transition = 'all 0.5s ease-out';
                    
                    requestAnimationFrame(() => {
                        nameReveal.style.opacity = '1';
                        nameReveal.style.transform = 'translateY(0)';
                    });
                }, 800);
            } catch (error) {
                alert('Invalid or expired link!');
            }
        }

        async function copyLink(linkId) {
            const linkText = document.getElementById(linkId).textContent;
            const btn = event.target.closest('.copy-btn');
            
            try {
                await navigator.clipboard.writeText(linkText);
                btn.classList.add('success');
                btn.innerHTML = '<i class="fas fa-check"></i>';
                
                setTimeout(() => {
                    btn.classList.remove('success');
                    btn.innerHTML = '<i class="fas fa-copy"></i>';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy:', err);
            }
        }
    </script>
</body>
</html>
