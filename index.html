<!DOCTYPE html>
<html>
<head>
    <title>Secret Santa Matcher ‚ú®</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --holiday-red: #d42426;
            --holiday-green: #1a472a;
            --snow-white: #ffffff;
            --gold: #e4c988;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Space Mono', monospace;
        }

        body {
            background: linear-gradient(135deg, #1a472a, #2d5a3c);
            color: #333;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
            border: 2px solid var(--gold);
            backdrop-filter: blur(10px);
        }

        h1 {
            color: var(--holiday-red);
            text-align: center;
            font-size: 2.2em;
            margin-bottom: 30px;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            letter-spacing: -1px;
        }

        .section-heading {
            color: var(--holiday-green);
            margin: 20px 0 15px;
            font-size: 1.2em;
            letter-spacing: -0.5px;
        }

        .preset-section {
            margin-bottom: 30px;
        }

        .manual-section {
            margin-bottom: 20px;
        }

        .input-group {
            margin: 20px 0;
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--holiday-green);
            letter-spacing: -0.5px;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
            transition: all 0.2s ease;
            font-family: 'Space Mono', monospace;
            letter-spacing: -0.5px;
        }

        input:focus {
            outline: none;
            border-color: var(--holiday-red);
            box-shadow: 0 0 0 3px rgba(212, 36, 38, 0.1);
        }

        button {
            background: var(--holiday-red);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            margin: 15px 0;
            transition: all 0.2s ease;
            font-family: 'Space Mono', monospace;
            letter-spacing: -0.5px;
        }

        button:hover {
            background: #b81e20;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 36, 38, 0.2);
        }

        .class-list {
            background: #f8fafc;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
        }

        .student-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 8px;
        }

        .student-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }

        .participant-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        #links {
            margin-top: 30px;
            padding: 20px;
            border-radius: 12px;
            background: rgba(26, 71, 42, 0.05);
        }

        .link-item {
            background: white;
            padding: 16px;
            margin: 12px 0;
            border-radius: 8px;
            border: 1px solid var(--gold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            word-break: break-all;
        }

        .link-text {
            flex-grow: 1;
            margin-right: 16px;
        }

        .copy-btn {
            background: var(--holiday-red);
            border: none;
            padding: 8px;
            width: 40px;
            height: 40px;
            margin: 0;
            color: white;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .copy-btn:hover {
            background: #b81e20;
            transform: scale(1.1);
        }

        .gift-container {
            text-align: center;
            margin: 20px 0;
        }

        .gift-label {
            color: var(--holiday-red);
            font-size: 1em;
            margin-bottom: 15px;
            opacity: 0.8;
            letter-spacing: -0.5px;
        }

        .gift-box {
            font-size: 100px;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: inline-block;
        }

        .gift-box:hover {
            transform: scale(1.1);
        }

        .name-reveal {
            font-size: 18px;
            margin: 30px;
            text-align: center;
            letter-spacing: -0.5px;
        }

        .name-reveal h2 {
            color: var(--holiday-green);
            font-size: 2em;
            margin: 20px 0;
            letter-spacing: -1px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        /* New footer styles */
        .footer {
            text-align: center;
            color: var(--snow-white);
            padding: 20px;
            font-size: 14px;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .footer:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .participant-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .participant-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }

            .container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div id="organizerView" class="container">
        <h1>üéÖ Secret Santa Matcher ‚ú®</h1>
        
        <div class="preset-section">
            <h2 class="section-heading">Presets</h2>
            <button onclick="loadClassList()" style="background-color: var(--holiday-green);">Class 4A</button>
        </div>

        <div class="manual-section">
            <h2 class="section-heading">Manual Entry</h2>
            <div class="input-group">
                <label>Number of Participants:</label>
                <input type="number" id="participantCount" min="2" max="100" placeholder="Enter number (2-100)">
                <button onclick="generateInputs()">Create Form</button>
            </div>
        </div>

        <div id="classList" class="class-list" style="display: none;"></div>
        <div id="participantInputs" class="participant-grid"></div>
        <button onclick="generateLinks()" id="generateButton" style="display:none">Generate Matches</button>
        <div id="links"></div>
    </div>

    <div id="revealerView" class="container" style="display:none">
        <h1>Your Secret Santa Match ü´Ç</h1>
        <div class="gift-container">
            <div class="gift-label">Click the gift to reveal!</div>
            <div class="gift-box" onclick="revealMatch()">üéÅ</div>
            <div class="name-reveal" id="nameReveal"></div>
        </div>
    </div>

    <!-- New footer -->
    <div class="footer">
        Coded with ‚ù§Ô∏è by Alvin
    </div>

    <script>
        let participants = [];
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('c');

        const classStudents = [
            "Mrs. Nikitha", "Lavanya", "Binusha", "Aakanksha", "Abdul Touheed", "Abhishek A", "Abhishek K", "Abhishek S S", 
            "Aditya Suresh", "Akash Surendra", "Akshata Suresh", "Akshay H", "Alvin", "Amulya", "Anaghashree", 
            "Ananya", "Aniketha", "Ankita", "Anushree", "Aralur Darshankumar", "Arfa Kulsum", "Arjun Sharma", 
            "Arun Eshwaroop", "Aviraj", "Ayush", "Balaji R", "Bapugouda", "Basavaraj", "Basavaraj B", "Bharath C", 
            "Bhargavi", "Bhavana", "Chandana Shree", "Chandan D P", "Channabasava", "Chethankumar", "Chethanashree", 
            "Chiranth L", "Christy Shephard", "D Manohar", "D Neha", "Danish", "Darshan", "Debaditya Das", "Deekshita", 
            "Deepthi", "Deeraj Ashok", "Dhanush D", "Dhanush Jain", "Dharshan V", "Dinesh Mange", "Disha", "E Vandana", 
            "Vishwanath", "Abdulaziz", "Abhishek Police Patil", "Abhishek Gouda", "Akbar", "Arpita Suresh", "Aryha K S", 
            "Ashish Gupta", "Ayesha", "Bhati Mohammed", "Bhavana A V", "Chandankumar V", "Vishesh Dhyan", "Darshan B", 
            "Darshan C", "Darshan Chikanna", "V Prajwal", "Mythri"
        ];

        if (code) {
            document.getElementById('revealerView').style.display = 'block';
            document.getElementById('organizerView').style.display = 'none';
        }

        function loadClassList() {
            const classList = document.getElementById('classList');
            classList.style.display = 'block';
            classList.innerHTML = '<h3 style="margin-bottom: 12px; color: var(--holiday-green);">Select Participants:</h3>';
            
            classStudents.forEach(student => {
                const div = document.createElement('div');
                div.className = 'student-item';
                div.innerHTML = `
                    <input type="checkbox" id="student-${student}" name="student-${student}" value="${student}">
                    <label for="student-${student}">${student}</label>
                `;
                classList.appendChild(div);
            });

            const selectButton = document.createElement('button');
            selectButton.textContent = 'Add Selected Students';
            selectButton.onclick = addSelectedStudents;
            classList.appendChild(selectButton);
        }

        function addSelectedStudents() {
            const selectedStudents = Array.from(document.querySelectorAll('.student-item input[type="checkbox"]:checked'))
                .map(checkbox => checkbox.value);
            
            if (selectedStudents.length < 2) {
                alert('Please select at least 2 students');
                return;
            }

            document.getElementById('participantCount').value = selectedStudents.length;
            generateInputs();

            const inputs = document.querySelectorAll('[name^="name"]');
            inputs.forEach((input, index) => {
                if (selectedStudents[index]) {
                    input.value = selectedStudents[index];
                }
            });

            document.getElementById('generateButton').style.display = 'block';
        }

        function generateInputs() {
            const count = parseInt(document.getElementById('participantCount').value);
            if (count < 2 || count > 100) {
                alert('Please enter a number between 2 and 100');
                return;
            }
            
            const container = document.getElementById('participantInputs');
            container.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const div = document.createElement('div');
                div.className = 'input-group';
                div.innerHTML = `<input required placeholder="Participant ${i + 1}" name="name${i}">`;
                container.appendChild(div);
            }
            document.getElementById('generateButton').style.display = 'block';
        }

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                console.error('Failed to copy text: ', err);
                return false;
            }
        }

        function generateLinks() {
            participants = [];
            const inputs = document.querySelectorAll('[name^="name"]');
            inputs.forEach(input => {
                if (input.value.trim()) {
                    participants.push(input.value.trim());
                }
            });

            if (participants.length < 2) {
                alert('Please add at least 2 participants');
                return;
            }

            let assigned = [...participants];
            do {
                assigned = assigned.sort(() => Math.random() - 0.5);
            } while (participants.some((p, i) => p === assigned[i]));

            const links = document.getElementById('links');
            links.innerHTML = '<h3 style="margin-bottom: 20px; color: var(--holiday-green);">Here is your Secret Santa List:</h3>';
            links.style.display = 'block';

            participants.forEach((name, i) => {
                const assignment = assigned[i];
                // Create a shorter data structure
                const data = `${name}|${assignment}`;
                // Use a shorter encryption method
                const encrypted = btoa(data).replace(/=/g, '').replace(/\+/g, '-').replace(/\//g, '_');
                const link = `${window.location.origin}${window.location.pathname}?c=${encrypted}`;
                
                const linkId = `link-${i}`;
                const div = document.createElement('div');
                div.className = 'link-item';
                div.innerHTML = `
                    <div class="link-text">
                        <strong>${name}'s Link</strong><br>
                        <span id="${linkId}">${link}</span>
                    </div>
                    <button class="copy-btn" onclick="copyLink('${linkId}')" title="Copy Link">
                        <i class="fas fa-copy"></i>
                    </button>
                `;
                links.appendChild(div);
            });
        }

        // And update the reveal function to work with the new format:
        function revealMatch() {
            try {
                const decoded = atob(code.replace(/-/g, '+').replace(/_/g, '/'));
                const [name, match] = decoded.split('|');
                
                const giftBox = document.querySelector('.gift-box');
                giftBox.style.transform = 'scale(0)';
                giftBox.style.transition = 'all 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
                
                setTimeout(() => {
                    const nameReveal = document.getElementById('nameReveal');
                    nameReveal.innerHTML = `
                        <p>‚ú® Ho Ho Ho! ‚ú®</p>
                        <p>${name}, you are Secret Santa for:</p>
                        <h2>${match}</h2>
                        <p>üéÑ Merry Christmas! üéÑ</p>
                    `;
                    nameReveal.style.opacity = '0';
                    nameReveal.style.transform = 'translateY(20px)';
                    nameReveal.style.transition = 'all 0.5s ease-out';
                    
                    requestAnimationFrame(() => {
                        nameReveal.style.opacity = '1';
                        nameReveal.style.transform = 'translateY(0)';
                    });
                }, 800);
            } catch (error) {
                alert('Invalid or expired link!');
            }
        }

        async function copyLink(linkId) {
            const linkText = document.getElementById(linkId).textContent;
            const success = await copyToClipboard(linkText);
            const btn = event.target.closest('.copy-btn');
            
            btn.innerHTML = success ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>';
            setTimeout(() => {
                btn.innerHTML = '<i class="fas fa-copy"></i>';
            }, 2000);
        }
    </script>
</body>
</html>
